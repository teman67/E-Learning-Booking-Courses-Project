{% extends 'base.html' %} {% load static %} {% block content %}

<style>
  .course-button.selected {
    background-color: #0c490e;
    /* Green color for selected courses */
    color: white;
  }

  .messages {
    list-style: none;
    padding: 10px;
    margin: 10px 0;
    border-radius: 5px;
  }

  .success {
    background-color: #4caf50;
    color: white;
  }

  .error {
    background-color: #f44336;
    color: white;
  }
</style>

{% if messages %}
<ul class="messages">
  {% for message in messages %}
  <li class="{% if message.tags %}{{ message.tags }}{% endif %}">
    {{ message }}
    <script>
      setTimeout(function () {
        var messageElement = document.querySelector(".messages");
        if (messageElement) {
          messageElement.remove();
        }
      }, 5000);
    </script>
  </li>
  {% endfor %}
</ul>
{% endif %}

<br />
<h2>Booking Page</h2>

<p>
  Fill out the form below to make a booking. You can select up to three courses.
  <b> Hold the Control key </b> to select multiple courses:
</p>

<form
  method="post"
  action="{% url 'booking' %}"
  onsubmit="return validateForm()"
>
  {% csrf_token %}

  <label for="first_name">First Name:</label>
  <input type="text" id="first_name" name="first_name" required />

  <label for="last_name">Last Name:</label>
  <input type="text" id="last_name" name="last_name" required />

  <label>Select Courses (up to 3):</label>

  {% for course in courses %}
  <button
    type="button"
    class="course-button"
    value="{{ course.name }}"
    onclick="toggleSelection(this)"
  >
    {{ course.name }}
  </button>
  {% endfor %}

  <input type="hidden" id="selectedCourses" name="courses" />

  <span id="selectionCount">0</span>/3 courses selected
  <button type="submit">Submit Booking</button>
</form>

<script>
  var selectedCourses = [];

  function toggleSelection(button) {
    var courseName = button.value;
    var index = selectedCourses.indexOf(courseName);

    if (index === -1) {
      // Course not selected, add to the list
      if (selectedCourses.length < 3) {
        selectedCourses.push(courseName);
        button.classList.add("selected");
      } else {
        alert("You can select up to 3 courses.");
      }
    } else {
      // Course already selected, remove from the list
      selectedCourses.splice(index, 1);
      button.classList.remove("selected");
    }

    // Update the hidden input with selected courses
    document.getElementById("selectedCourses").value =
      selectedCourses.join(",");
    document.getElementById("selectionCount").innerHTML =
      selectedCourses.length;
  }

  function validateForm() {
    if (selectedCourses.length === 0) {
      alert("Please select at least one course.");
      return false;
    } else if (selectedCourses.length > 3) {
      alert("You can select up to 3 courses.");
      return false;
    }
    return true;
  }
</script>

{% endblock %}
